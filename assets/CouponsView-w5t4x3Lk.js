import{m as y,D as V}from"./DelModal-04sA68Mm.js";import{_ as C,o as p,c as u,a as o,f as c,v as r,E as k,S as i,r as _,b,e as x,F as L,j as D,t as f}from"./index-Up3SR1ci.js";import{V as w}from"./VueLoading-BXeJux7y.js";const P={name:"couponModal",props:{coupon:{}},data(){return{tempCoupon:{},due_date:""}},emits:["update-coupon"],watch:{coupon(){this.tempCoupon=this.coupon;const s=new Date(this.tempCoupon.due_date*1e3).toISOString().split("T");[this.due_date]=s},due_date(){this.tempCoupon.due_date=Math.floor(new Date(this.due_date)/1e3)}},mixins:[y]},T={class:"modal fade",id:"couponModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},A={class:"modal-dialog",role:"document"},E={class:"modal-content"},I=o("div",{class:"modal-header"},[o("h5",{class:"modal-title",id:"exampleModalLabel"},"優惠券"),o("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),N={class:"modal-body"},S={class:"mb-3"},U=o("label",{for:"title"},"標題",-1),B={class:"mb-3"},O=o("label",{for:"coupon_code"},"優惠碼",-1),j={class:"mb-3"},R=o("label",{for:"due_date"},"到期日",-1),F={class:"mb-3"},H=o("label",{for:"price"},"折扣百分比",-1),q={class:"mb-3"},z={class:"form-check"},G=o("label",{class:"form-check-label",for:"is_enabled"}," 是否啟用 ",-1),J={class:"modal-footer"},K=o("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"關閉",-1);function Q(s,e,l,v,t,a){return p(),u("div",T,[o("div",A,[o("div",E,[I,o("div",N,[o("div",S,[U,c(o("input",{type:"text",class:"form-control",id:"title","onUpdate:modelValue":e[0]||(e[0]=n=>t.tempCoupon.title=n),placeholder:"請輸入標題"},null,512),[[r,t.tempCoupon.title]])]),o("div",B,[O,c(o("input",{type:"text",class:"form-control",id:"coupon_code","onUpdate:modelValue":e[1]||(e[1]=n=>t.tempCoupon.code=n),placeholder:"請輸入優惠碼"},null,512),[[r,t.tempCoupon.code]])]),o("div",j,[R,c(o("input",{type:"date",class:"form-control",id:"due_date","onUpdate:modelValue":e[2]||(e[2]=n=>t.due_date=n)},null,512),[[r,t.due_date]])]),o("div",F,[H,c(o("input",{type:"number",class:"form-control",id:"price","onUpdate:modelValue":e[3]||(e[3]=n=>t.tempCoupon.percent=n),placeholder:"請輸入折扣百分比"},null,512),[[r,t.tempCoupon.percent,void 0,{number:!0}]])]),o("div",q,[o("div",z,[c(o("input",{class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":e[4]||(e[4]=n=>t.tempCoupon.is_enabled=n),id:"is_enabled"},null,512),[[k,t.tempCoupon.is_enabled]]),G])])]),o("div",J,[K,o("button",{type:"button",class:"btn btn-primary",onClick:e[5]||(e[5]=n=>s.$emit("update-coupon",t.tempCoupon))}," 更新優惠券 ")])])])],512)}const W=C(P,[["render",Q]]);var X={VITE_APP_API:"https://vue3-course-api.hexschool.io/",VITE_APP_PATH:"funniecafeweb",BASE_URL:"/vite-milkproject/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_API:m,VITE_APP_PATH:h}=X,Y={components:{VueLoading:w,CouponModal:W,DelModal:V},props:{config:Object},data(){return{coupons:{},tempCoupon:{title:"",is_enabled:0,percent:100,code:""},isLoading:!1,isNew:!1}},methods:{openCouponModal(s,e){this.isNew=s,this.isNew?this.tempCoupon={due_date:new Date().getTime()/1e3}:this.tempCoupon={...e},this.$refs.couponModal.showModal()},openDelCouponModal(s){this.tempCoupon={...s},this.$refs.delModal.showModal()},getCoupons(){const s=`${m}api/${h}/admin/coupons`;this.isLoading=!0,this.$http.get(s,this.tempProduct).then(e=>{this.coupons=e.data.coupons,this.isLoading=!1})},updateCoupon(s){if(this.isNew){const e=`${m}api/${h}/admin/coupon`;this.isLoading=!0,this.$http.post(e,{data:s}).then(l=>{this.isLoading=!1,l.data.success?(i("success","新增優惠劵成功"),this.getCoupons(),this.$refs.couponModal.hideModal()):i("error","新增優惠劵失敗")})}else{const e=`${m}api/${h}/admin/coupon/${this.tempCoupon.id}`;this.isLoading=!0,this.$http.put(e,{data:this.tempCoupon}).then(l=>{this.isLoading=!1,l.data.success?(i("success","更新優惠劵成功"),this.getCoupons(),this.$refs.couponModal.hideModal()):i("error","更新優惠劵失敗")}).catch(l=>{i("error",`${l.response.data.message}`)})}},delCoupon(){const s=`${m}api/${h}/admin/coupon/${this.tempCoupon.id}`;this.isLoading=!0,this.$http.delete(s).then(e=>{this.isLoading=!1,e.data.success?(i("success","刪除優惠劵成功"),this.$refs.delModal.hideModal(),this.getCoupons()):i("error","刪除優惠劵失敗")}).catch(e=>{i("error",`${e.response.data.message}`)})}},created(){this.getCoupons()}},Z={class:"text-end mt-4"},oo=o("i",{class:"bi bi-plus-lg pe-1"},null,-1),eo={class:"table mt-4"},to=o("thead",null,[o("tr",null,[o("th",null,"名稱"),o("th",null,"折扣百分比"),o("th",null,"到期日"),o("th",null,"是否啟用"),o("th",null,"編輯")])],-1),so={key:0,class:"text-success"},no={key:1,class:"text-muted"},lo={class:"btn-group"},io=["onClick"],ao=["onClick"];function po(s,e,l,v,t,a){const n=_("VueLoading"),M=_("couponModal"),g=_("DelModal");return p(),u("div",null,[b(n,{active:t.isLoading},null,8,["active"]),o("div",Z,[o("button",{class:"btn btn-primary",type:"button",onClick:e[0]||(e[0]=d=>a.openCouponModal(!0))},[oo,x("新增優惠券 ")])]),o("table",eo,[to,o("tbody",null,[(p(!0),u(L,null,D(t.coupons,d=>(p(),u("tr",{key:`coupon ${d.id}`},[o("td",null,f(d.title),1),o("td",null,f(d.percent)+"%",1),o("td",null,f(s.$filters.date(d.due_date)),1),o("td",null,[d.is_enabled===1?(p(),u("span",so,"啟用")):(p(),u("span",no,"未起用"))]),o("td",null,[o("div",lo,[o("button",{class:"btn btn-outline-primary btn-sm",type:"button",onClick:$=>a.openCouponModal(!1,d)}," 編輯 ",8,io),o("button",{class:"btn btn-outline-danger btn-sm",type:"button",onClick:$=>a.openDelCouponModal(d)}," 刪除 ",8,ao)])])]))),128))])]),b(M,{coupon:t.tempCoupon,ref:"couponModal",onUpdateCoupon:a.updateCoupon},null,8,["coupon","onUpdateCoupon"]),b(g,{item:t.tempCoupon,ref:"delModal",onDelItem:a.delCoupon},null,8,["item","onDelItem"])])}const mo=C(Y,[["render",po]]);export{mo as default};
