import{_ as D,l as r,A as L,o as a,c as l,a as e,t as s,x as V,F as g,q as E,n as S,r as k,b as $,i as w,S as b,p as T,g as N,I as U}from"./index-If2eL0tu.js";import{V as B}from"./VueLoading-D62Lhxuy.js";import{u as q,D as R}from"./DelModal-ljDGubuH.js";import{P as j}from"./PaginationComponent-D72MKxSJ.js";const F={name:"orderModal",props:{order:{type:Object,default(){return{}}}},emits:["update-product","update-order"],setup(c,{emit:v}){const{modalElement:O,showModal:t,hideModal:h}=q(),m=r(""),n=r({}),u=r({}),_=r(!1);return L(()=>c.order,o=>{u.value=o,_.value=u.value.is_paid}),{modal:m,status:n,tempOrder:u,isPaid:_,showModal:t,hideModal:h,modalElement:O,pushOrderModal:()=>{v("update-order",u.value)}}}},H={class:"modal fade",id:"productModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modalElement"},z={class:"modal-dialog modal-xl",role:"document"},G={class:"modal-content border-0"},J=e("div",{class:"modal-header bg-primary text-white"},[e("h5",{class:"modal-title",id:"exampleModalLabel"},[e("span",null,"訂單細節")]),e("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close"})],-1),K={class:"modal-body"},Q={class:"row"},W={class:"col-md-4"},X=e("h3",null,"用戶資料",-1),Y={class:"table"},Z={key:0},ee=e("th",{class:"order-modal-table"},"姓名",-1),te=e("th",null,"Email",-1),oe=e("th",null,"電話",-1),se=e("th",null,"地址",-1),ae={class:"col-md-8"},le=e("h3",null,"訂單細節",-1),ne={class:"table"},de=e("th",{class:"order-modal-table"},"訂單編號",-1),re=e("th",null,"下單時間",-1),ce=e("th",null,"付款時間",-1),ie={key:0},ue={key:1},_e=e("th",null,"付款狀態",-1),pe={key:0,class:"text-success"},he={key:1,class:"text-muted"},me=e("th",null,"總金額",-1),fe=e("h3",null,"選購商品",-1),be={class:"table"},ve=e("thead",null,[e("tr")],-1),Oe={class:"text-end"},ye={class:"modal-footer"},ge=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function Me(c,v,O,t,h,m){return a(),l("div",H,[e("div",z,[e("div",G,[J,e("div",K,[e("div",Q,[e("div",W,[X,e("table",Y,[t.tempOrder.user?(a(),l("tbody",Z,[e("tr",null,[ee,e("td",null,s(t.tempOrder.user.name),1)]),e("tr",null,[te,e("td",null,s(t.tempOrder.user.email),1)]),e("tr",null,[oe,e("td",null,s(t.tempOrder.user.tel),1)]),e("tr",null,[se,e("td",null,s(t.tempOrder.user.address),1)])])):V("",!0)])]),e("div",ae,[le,e("table",ne,[e("tbody",null,[e("tr",null,[de,e("td",null,s(t.tempOrder.id),1)]),e("tr",null,[re,e("td",null,s(c.$filters.date(t.tempOrder.create_at)),1)]),e("tr",null,[ce,e("td",null,[t.tempOrder.paid_date?(a(),l("span",ie,s(c.$filters.date(t.tempOrder.paid_date)),1)):(a(),l("span",ue,"時間不正確"))])]),e("tr",null,[_e,e("td",null,[t.tempOrder.is_paid?(a(),l("strong",pe,"已付款")):(a(),l("span",he,"尚未付款"))])]),e("tr",null,[me,e("td",null,s(c.$filters.currency(t.tempOrder.total)),1)])])]),fe,e("table",be,[ve,e("tbody",null,[(a(!0),l(g,null,E(t.tempOrder.products,n=>(a(),l("tr",{key:n.id},[e("th",null,s(n.product.title),1),e("td",null,s(n.qty)+" / "+s(n.product.unit),1),e("td",Oe,s(c.$filters.currency(n.final_total)),1)]))),128))])])])])]),e("div",ye,[ge,e("button",{type:"button",class:"btn btn-primary",onClick:v[0]||(v[0]=(...n)=>t.pushOrderModal&&t.pushOrderModal(...n))},"確認")])])])],512)}const ke=D(F,[["render",Me]]);var $e={VITE_APP_API:"https://vue3-course-api.hexschool.io/",VITE_APP_PATH:"funniecafeweb",BASE_URL:"/vite-milkproject/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_API:x,VITE_APP_PATH:C}=$e,we={components:{VueLoading:B,Pagination:j,DelModal:R,OrderModal:ke},setup(){const c=r({}),v=r(!1),O=r({}),t=r(!1),h=r({}),m=r(1),n=r(null),u=r(null);function _(d=1){m.value=d;const i=`${x}api/${C}/admin/orders?page=${d}`;t.value=!0,w.get(i,h).then(f=>{t.value=!1,c.value=f.data.orders,O.value=f.data.pagination}).catch(f=>{t.value=!1,b("error",`${f.response.data.message}`)})}function M(d){h.value={...d},n.value.showModal()}function o(d){h.value={...d},u.value.showModal()}function p(d){const i=`${x}api/${C}/admin/order/${d.id}`,f={is_paid:d.is_paid};t.value=!0,w.put(i,{data:f}).then(y=>{t.value=!1,y.data.success?(_(m.value),b("success","更新付款狀態成功")):b("error","更新付款狀態失敗")}).catch(y=>{t.value=!1,b("error",`${y.response.data.message}`)})}function P(d){const i=`${x}api/${C}/admin/order/${d.id}`,f={is_paid:d.is_paid};t.value=!0;const y=n.value;w.put(i,{data:f}).then(A=>{t.value=!1,y.hideModal(),A.data.success?(_(m.value),b("success","確認成功")):(t.value=!1,b("error","確認失敗"))})}function I(){const d=`${x}api/${C}/admin/order/${h.value.id}`;t.value=!0,w.delete(d).then(i=>{t.value=!1,u.value.hideModal(),i.data.success?(b("success","刪除成功"),_(m.value)):b("error","刪除失敗")}).catch(i=>{t.value=!1,b("error",`${i.response.data.message}`)})}return S(()=>{_()}),{orders:c,isNew:v,pagination:O,isLoading:t,tempOrder:h,currentPage:m,getOrders:_,openModal:M,openDelOrderModal:o,updatePaid:p,delOrder:I,orderModal:n,delModal:u,checkOrderInfo:P}}},xe={class:"table-responsive"},Ce={class:"table mt-4"},Pe=e("thead",null,[e("tr",{class:"table-nowrap"},[e("th",{class:"text-nowrap"},"購買時間"),e("th",null,"Email"),e("th",{class:"text-nowrap"},"購買款項"),e("th",{class:"text-nowrap"},"應付金額"),e("th",{class:"text-nowrap"},"是否付款"),e("th",null,"編輯")])],-1),Ve=["textContent"],Ee={class:"list-unstyled text-nowrap"},De={class:"text-right"},Ie={class:"form-check form-switch"},Ae=["id","onUpdate:modelValue","onChange"],Le=["for"],Se={key:0},Te={key:1},Ne={class:"btn-group"},Ue=["onClick"],Be=["onClick"];function qe(c,v,O,t,h,m){const n=k("VueLoading"),u=k("OrderModal"),_=k("DelModal"),M=k("Pagination");return a(),l(g,null,[$(n,{active:t.isLoading},null,8,["active"]),e("div",xe,[e("table",Ce,[Pe,e("tbody",null,[(a(!0),l(g,null,E(t.orders,o=>(a(),l(g,{key:`orders ${o.id}`},[t.orders.length?(a(),l("tr",{key:0,class:T({"text-secondary":!o.is_paid})},[e("td",null,s(c.$filters.date(o.create_at)),1),e("td",null,[o.user?(a(),l("span",{key:0,textContent:s(o.user.email)},null,8,Ve)):V("",!0)]),e("td",null,[e("ul",Ee,[(a(!0),l(g,null,E(o.products,(p,P)=>(a(),l("li",{key:P},s(p.product.title)+" 數量："+s(p.qty)+" "+s(p.product.unit),1))),128))])]),e("td",De,s(o.total),1),e("td",null,[e("div",Ie,[N(e("input",{class:"form-check-input",type:"checkbox",id:`paidSwitch${o.id}`,"onUpdate:modelValue":p=>o.is_paid=p,onChange:p=>t.updatePaid(o)},null,40,Ae),[[U,o.is_paid]]),e("label",{class:"form-check-label text-nowrap",for:`paidSwitch${o.id}`},[o.is_paid?(a(),l("span",Se,"已付款")):(a(),l("span",Te,"未付款"))],8,Le)])]),e("td",null,[e("div",Ne,[e("button",{class:"btn btn-outline-primary btn-sm",type:"button",onClick:p=>t.openModal(o)}," 檢視 ",8,Ue),e("button",{class:"btn btn-outline-danger btn-sm",type:"button",onClick:p=>t.openDelOrderModal(o)}," 刪除 ",8,Be)])])],2)):V("",!0)],64))),128))])])]),$(u,{order:t.tempOrder,ref:"orderModal",onUpdateOrder:t.checkOrderInfo},null,8,["order","onUpdateOrder"]),$(_,{item:t.tempOrder,ref:"delModal",onDelItem:t.delOrder},null,8,["item","onDelItem"]),$(M,{pages:t.pagination,onEmitPages:t.getOrders},null,8,["pages","onEmitPages"])],64)}const ze=D(we,[["render",qe]]);export{ze as default};
