import{V as F}from"./VueLoading-D62Lhxuy.js";import{_ as U,l as f,A as S,o as u,c as m,a as t,g as r,v as _,F as C,q as D,x as I,I as $,i as k,e as T,n as R,r as y,b as V,S as g,t as w}from"./index-If2eL0tu.js";import{u as B,D as H}from"./DelModal-ljDGubuH.js";import{P as N}from"./PaginationComponent-D72MKxSJ.js";var O={VITE_APP_API:"https://vue3-course-api.hexschool.io/",VITE_APP_PATH:"funniecafeweb",BASE_URL:"/vite-milkproject/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_API:j,VITE_APP_PATH:q}=O,z={props:{product:{type:Object,default(){return{}}}},emits:["update-product"],setup(b,{emit:l}){const{modalElement:i,showModal:o,hideModal:s}=B(),h=f({}),e=f({});S(()=>b.product,v=>{e.value=v,e.value.images||(e.value.images=[])});function d(){const v=h.value.$refs.fileInput.files[0],a=new FormData;a.append("file-to-upload",v);const x=`${j}api/${q}/admin/upload`;k.post(x,a).then(n=>{n.data.success&&(e.value.imageUrl=n.data.imageUrl)})}return{tempProduct:e,uploadFile:d,showModal:o,hideModal:s,modalElement:i,pushProduct:()=>{l("update-product",e.value)}}}},G={class:"modal fade",id:"exampleModal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modalElement"},J={class:"modal-dialog modal-xl",role:"document"},K={class:"modal-content border-0"},Q=t("div",{class:"modal-header bg-primary text-white"},[t("h5",{class:"modal-title",id:"exampleModalLabel"},[t("span",null,"產品內容")]),t("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close"})],-1),W={class:"modal-body"},X={class:"row"},Y={class:"col-sm-4"},Z={class:"mb-3"},tt=t("label",{for:"image",class:"form-label"},"輸入圖片網址",-1),ot={class:"mb-3"},et=t("label",{for:"customFile",class:"form-label"},[T("或 上傳圖片 "),t("i",{class:"fas fa-spinner fa-spin"})],-1),lt=["src","alt"],st={key:0,class:"mt-5"},at=["onUpdate:modelValue"],nt=["src","alt"],dt=["onClick"],ct={key:0},it={class:"col-sm-8"},rt={class:"mb-3"},ut=t("label",{for:"title",class:"form-label"},"標題",-1),mt={class:"row gx-2"},pt={class:"mb-3 col-md-6"},_t=t("label",{for:"category",class:"form-label"},"分類",-1),ft={class:"mb-3 col-md-6"},bt=t("label",{for:"price",class:"form-label"},"單位",-1),ht={class:"row gx-2"},Pt={class:"mb-3 col-md-6"},vt=t("label",{for:"origin_price",class:"form-label"},"原價",-1),gt={class:"mb-3 col-md-6"},xt=t("label",{for:"price",class:"form-label"},"售價",-1),yt=t("hr",null,null,-1),Vt={class:"mb-3"},wt=t("label",{for:"description",class:"form-label"},"產品描述",-1),Mt={class:"mb-3"},At=t("label",{for:"content",class:"form-label"},"說明內容",-1),kt={class:"mb-3"},Et={class:"form-check"},Ct=t("label",{class:"form-check-label",for:"is_enabled"}," 是否上架 ",-1),It={class:"modal-footer"},Ut=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function Dt(b,l,i,o,s,h){return u(),m("div",G,[t("div",J,[t("div",K,[Q,t("div",W,[t("div",X,[t("div",Y,[t("div",Z,[tt,r(t("input",{type:"text",class:"form-control",id:"image","onUpdate:modelValue":l[0]||(l[0]=e=>o.tempProduct.imageUrl=e),placeholder:"請輸入圖片連結"},null,512),[[_,o.tempProduct.imageUrl]])]),t("div",ot,[et,t("input",{type:"file",id:"customFile",class:"form-control",ref:"fileInput",onChange:l[1]||(l[1]=(...e)=>o.uploadFile&&o.uploadFile(...e))},null,544)]),t("img",{class:"img-fluid",src:o.tempProduct.imageUrl,alt:`${o.tempProduct.title} 圖片`},null,8,lt),o.tempProduct.images?(u(),m("div",st,[(u(!0),m(C,null,D(o.tempProduct.images,(e,d)=>(u(),m("div",{class:"mb-3 input-group",key:d},[r(t("input",{type:"url",class:"form-control form-control","onUpdate:modelValue":P=>o.tempProduct.images[d]=P,placeholder:"請輸入連結"},null,8,at),[[_,o.tempProduct.images[d]]]),t("div",null,[t("img",{class:"img-fluid",src:e,alt:`${o.tempProduct.title} 圖片`},null,8,nt)]),t("button",{type:"button",class:"btn btn-outline-danger",onClick:P=>o.tempProduct.images.splice(d,1)}," 移除 ",8,dt)]))),128)),o.tempProduct.images[o.tempProduct.images.length-1]||!o.tempProduct.images.length?(u(),m("div",ct,[t("button",{class:"btn btn-outline-primary btn-sm d-block w-100",type:"button",onClick:l[2]||(l[2]=e=>o.tempProduct.images.push(""))}," 新增圖片 ")])):I("",!0)])):I("",!0)]),t("div",it,[t("div",rt,[ut,r(t("input",{type:"text",class:"form-control",id:"title","onUpdate:modelValue":l[3]||(l[3]=e=>o.tempProduct.title=e),placeholder:"請輸入標題"},null,512),[[_,o.tempProduct.title]])]),t("div",mt,[t("div",pt,[_t,r(t("input",{type:"text",class:"form-control",id:"category","onUpdate:modelValue":l[4]||(l[4]=e=>o.tempProduct.category=e),placeholder:"請輸入分類"},null,512),[[_,o.tempProduct.category]])]),t("div",ft,[bt,r(t("input",{type:"text",class:"form-control",id:"unit","onUpdate:modelValue":l[5]||(l[5]=e=>o.tempProduct.unit=e),placeholder:"請輸入單位"},null,512),[[_,o.tempProduct.unit]])])]),t("div",ht,[t("div",Pt,[vt,r(t("input",{type:"number",class:"form-control",id:"origin_price","onUpdate:modelValue":l[6]||(l[6]=e=>o.tempProduct.origin_price=e),placeholder:"請輸入原價"},null,512),[[_,o.tempProduct.origin_price,void 0,{number:!0}]])]),t("div",gt,[xt,r(t("input",{type:"number",class:"form-control",id:"price","onUpdate:modelValue":l[7]||(l[7]=e=>o.tempProduct.price=e),placeholder:"請輸入售價"},null,512),[[_,o.tempProduct.price,void 0,{number:!0}]])])]),yt,t("div",Vt,[wt,r(t("textarea",{type:"text",class:"form-control",id:"description","onUpdate:modelValue":l[8]||(l[8]=e=>o.tempProduct.description=e),placeholder:"請輸入產品描述"},null,512),[[_,o.tempProduct.description]])]),t("div",Mt,[At,r(t("textarea",{type:"text",class:"form-control",id:"content","onUpdate:modelValue":l[9]||(l[9]=e=>o.tempProduct.content=e),placeholder:"請輸入產品說明內容"},null,512),[[_,o.tempProduct.content]])]),t("div",kt,[t("div",Et,[r(t("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":l[10]||(l[10]=e=>o.tempProduct.is_enabled=e),"true-value":1,"false-value":0,id:"is_enabled"},null,512),[[$,o.tempProduct.is_enabled]]),Ct])])])])]),t("div",It,[Ut,t("button",{type:"button",class:"btn btn-primary",onClick:l[11]||(l[11]=(...e)=>o.pushProduct&&o.pushProduct(...e))},"確認")])])])],512)}const Tt=U(z,[["render",Dt]]);var Lt={VITE_APP_API:"https://vue3-course-api.hexschool.io/",VITE_APP_PATH:"funniecafeweb",BASE_URL:"/vite-milkproject/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_API:M,VITE_APP_PATH:A}=Lt,Ft={components:{VueLoading:F,ProductModal:Tt,DelModal:H,Pagination:N},setup(){const b=f([]),l=f({}),i=f({}),o=f(!1),s=f(!1),h=f(null),e=f(null);function d(n=1){const p=`${M}api/${A}/admin/products/?page=${n}`;s.value=!0,k.get(p).then(c=>{s.value=!1,c.data.success&&(b.value=c.data.products,l.value=c.data.pagination)}).catch(c=>{s.value=!1,g("error",`${c.response.data.message}`)})}function P(n,p){n?i.value={}:i.value={...p},o.value=n,h.value.showModal()}function v(n){i.value={...n};let p=`${M}api/${A}/admin/product`,c="post";s.value=!0,o.value||(p=`${M}api/${A}/admin/product/${n.id}`,c="put");const L=h.value;k[c](p,{data:i.value}).then(E=>{s.value=!1,L.hideModal(),E.data.success?(d(),g("success","更新成功")):g("error","更新失敗")}).catch(E=>{s.value=!1,g("error",`${E.response.data.message}`)})}function a(n){i.value={...n},e.value.showModal()}function x(){const n=`${M}api/${A}/admin/product/${i.value.id}`,p=e.value;s.value=!0,k.delete(n).then(c=>{s.value=!1,p.hideModal(),c.data.success?(d(),g("success","刪除成功")):g("error","刪除失敗")}).catch(c=>{s.value=!1,g("error",`${c.response.data.message}`)})}return R(()=>{d()}),{products:b,pagination:l,tempProduct:i,isNew:o,isLoading:s,getProducts:d,openModal:P,updateProduct:v,openDelProductModal:a,productModal:h,delProduct:x,delModal:e}}},St={class:"text-end mt-3"},$t=t("i",{class:"bi bi-plus-lg pe-1"},null,-1),Rt={class:"table-responsive"},Bt={class:"table mt-4"},Ht=t("thead",null,[t("tr",{class:"table-nowrap"},[t("th",{class:"text-nowrap",width:"120"},"分類"),t("th",{class:"text-nowrap"},"產品名稱"),t("th",{class:"text-nowrap",width:"120"},"原價"),t("th",{class:"text-nowrap",width:"120"},"售價"),t("th",{class:"text-nowrap",width:"100"},"是否上架"),t("th",{class:"text-nowrap",width:"200"},"編輯")])],-1),Nt={class:"text-nowrap"},Ot={class:"text-nowrap"},jt={class:"text-right"},qt={class:"text-right"},zt={key:0,class:"text-success"},Gt={key:1,class:"text-muted"},Jt={class:"btn-group"},Kt=["onClick"],Qt=["onClick"];function Wt(b,l,i,o,s,h){const e=y("VueLoading"),d=y("Pagination"),P=y("ProductModal"),v=y("DelModal");return u(),m(C,null,[V(e,{active:o.isLoading},null,8,["active"]),t("div",St,[t("button",{class:"btn btn-primary",type:"button",onClick:l[0]||(l[0]=a=>o.openModal(!0))},[$t,T("新增產品 ")])]),t("div",Rt,[t("table",Bt,[Ht,t("tbody",null,[(u(!0),m(C,null,D(o.products,a=>(u(),m("tr",{key:a.id},[t("td",Nt,w(a.category),1),t("td",Ot,w(a.title),1),t("td",jt,w(b.$filters.currency(a.origin_price)),1),t("td",qt,w(b.$filters.currency(a.price)),1),t("td",null,[a.is_enabled?(u(),m("span",zt,"上架")):(u(),m("span",Gt,"未上架"))]),t("td",null,[t("div",Jt,[t("button",{class:"btn btn-outline-primary btn-sm",type:"button",onClick:x=>o.openModal(!1,a)}," 編輯 ",8,Kt),t("button",{class:"btn btn-outline-danger btn-sm",type:"button",onClick:x=>o.openDelProductModal(a)}," 刪除 ",8,Qt)])])]))),128))])])]),V(d,{pages:o.pagination,onEmitPages:o.getProducts},null,8,["pages","onEmitPages"]),V(P,{ref:"productModal",product:o.tempProduct,onUpdateProduct:o.updateProduct},null,8,["product","onUpdateProduct"]),V(v,{item:o.tempProduct,ref:"delModal",onDelItem:o.delProduct},null,8,["item","onDelItem"])],64)}const oo=U(Ft,[["render",Wt]]);export{oo as default};
