import{V as P}from"./VueLoading-D62Lhxuy.js";import{_ as D,l as r,A as w,o as b,c as v,a as o,g as f,v as C,I as A,n as T,r as $,b as V,e as E,F as I,q as L,i as M,S as i,t as k}from"./index-If2eL0tu.js";import{u as S,D as U}from"./DelModal-ljDGubuH.js";const N={name:"couponModal",props:{coupon:{}},emits:["update-coupon"],setup(_,{emit:t}){const{modalElement:s,showModal:e,hideModal:p}=S(),d=r({}),n=r("");return w(()=>_.coupon,c=>{d.value=c;const l=new Date(d.value.due_date*1e3).toISOString().split("T");[n.value]=l}),w(n,c=>{d.value.due_date=Math.floor(new Date(c)/1e3)}),{tempCoupon:d,due_date:n,modalElement:s,pushCoupon:()=>{t("update-coupon",d.value)},showModal:e,hideModal:p}}},B={class:"modal fade",id:"couponModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modalElement"},O={class:"modal-dialog",role:"document"},R={class:"modal-content"},j=o("div",{class:"modal-header"},[o("h5",{class:"modal-title",id:"exampleModalLabel"},"優惠券"),o("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),F={class:"modal-body"},H={class:"mb-3"},q=o("label",{for:"title"},"標題",-1),z={class:"mb-3"},G=o("label",{for:"coupon_code"},"優惠碼",-1),J={class:"mb-3"},K=o("label",{for:"due_date"},"到期日",-1),Q={class:"mb-3"},W=o("label",{for:"price"},"折扣百分比",-1),X={class:"mb-3"},Y={class:"form-check"},Z=o("label",{class:"form-check-label",for:"is_enabled"}," 是否啟用 ",-1),oo={class:"modal-footer"},eo=o("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"關閉",-1);function to(_,t,s,e,p,d){return b(),v("div",B,[o("div",O,[o("div",R,[j,o("div",F,[o("div",H,[q,f(o("input",{type:"text",class:"form-control",id:"title","onUpdate:modelValue":t[0]||(t[0]=n=>e.tempCoupon.title=n),placeholder:"請輸入標題"},null,512),[[C,e.tempCoupon.title]])]),o("div",z,[G,f(o("input",{type:"text",class:"form-control",id:"coupon_code","onUpdate:modelValue":t[1]||(t[1]=n=>e.tempCoupon.code=n),placeholder:"請輸入優惠碼"},null,512),[[C,e.tempCoupon.code]])]),o("div",J,[K,f(o("input",{type:"date",class:"form-control",id:"due_date","onUpdate:modelValue":t[2]||(t[2]=n=>e.due_date=n)},null,512),[[C,e.due_date]])]),o("div",Q,[W,f(o("input",{type:"number",class:"form-control",id:"price","onUpdate:modelValue":t[3]||(t[3]=n=>e.tempCoupon.percent=n),placeholder:"請輸入折扣百分比"},null,512),[[C,e.tempCoupon.percent,void 0,{number:!0}]])]),o("div",X,[o("div",Y,[f(o("input",{class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":t[4]||(t[4]=n=>e.tempCoupon.is_enabled=n),id:"is_enabled"},null,512),[[A,e.tempCoupon.is_enabled]]),Z])])]),o("div",oo,[eo,o("button",{type:"button",class:"btn btn-primary",onClick:t[5]||(t[5]=(...n)=>e.pushCoupon&&e.pushCoupon(...n))},"確認")])])])],512)}const no=D(N,[["render",to]]);var so={VITE_APP_API:"https://vue3-course-api.hexschool.io/",VITE_APP_PATH:"funniecafeweb",BASE_URL:"/vite-milkproject/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_API:y,VITE_APP_PATH:g}=so,ao={components:{VueLoading:P,CouponModal:no,DelModal:U},props:{config:Object},setup(){const _=r({}),t=r({title:"",is_enabled:0,percent:100,code:""}),s=r(!1),e=r(!1),p=r(null),d=r(null);function n(u,a){e.value=u,e.value?t.value.due_date=new Date().getTime()/1e3:t.value={...a},p.value.showModal()}function h(u){t.value={...u},d.value.showModal()}function c(){const u=`${y}api/${g}/admin/coupons`;s.value=!0,M.get(u,t.value).then(a=>{s.value=!1,_.value=a.data.coupons}).catch(a=>{s.value=!1,i("error",`${a.response.data.message}`)})}function l(u){if(e.value){const a=`${y}api/${g}/admin/coupon`;s.value=!0,M.post(a,{data:u}).then(m=>{s.value=!1,m.data.success?(i("success","新增優惠劵成功"),c(),p.value.hideModal()):i("error","新增優惠劵失敗")})}else{const a=`${y}api/${g}/admin/coupon/${u.id}`;s.value=!0,M.put(a,{data:u}).then(m=>{s.value=!1,m.data.success?(i("success","更新優惠劵成功"),c(),p.value.hideModal()):i("error","更新優惠劵失敗")}).catch(m=>{s.value=!1,i("error",`${m.response.data.message}`)})}}function x(){const u=`${y}api/${g}/admin/coupon/${t.value.id}`;s.value=!0,M.delete(u).then(a=>{s.value=!1,a.data.success?(i("success","刪除優惠劵成功"),d.value.hideModal(),c()):i("error","刪除優惠劵失敗")}).catch(a=>{s.value=!1,i("error",`${a.response.data.message}`)})}return T(()=>{c()}),{coupons:_,tempCoupon:t,isLoading:s,isNew:e,couponModal:p,delModal:d,openCouponModal:n,openDelCouponModal:h,getCoupons:c,updateCoupon:l,delCoupon:x}}},lo={class:"text-end mt-4"},co=o("i",{class:"bi bi-plus-lg pe-1"},null,-1),uo={class:"table-responsive"},io={class:"table mt-4"},po=o("thead",null,[o("tr",{class:"table-nowrap"},[o("th",null,"名稱"),o("th",{class:"text-nowrap"},"折扣百分比"),o("th",null,"到期日"),o("th",{class:"text-nowrap"},"是否啟用"),o("th",null,"編輯")])],-1),ro={class:"text-nowrap"},_o={class:"text-nowrap"},mo={key:0,class:"text-success"},bo={key:1,class:"text-muted"},vo={class:"btn-group"},fo=["onClick"],ho=["onClick"];function Co(_,t,s,e,p,d){const n=$("VueLoading"),h=$("couponModal"),c=$("DelModal");return b(),v("div",null,[V(n,{active:e.isLoading},null,8,["active"]),o("div",lo,[o("button",{class:"btn btn-primary",type:"button",onClick:t[0]||(t[0]=l=>e.openCouponModal(!0))},[co,E("新增優惠券 ")])]),o("div",uo,[o("table",io,[po,o("tbody",null,[(b(!0),v(I,null,L(e.coupons,l=>(b(),v("tr",{key:`coupon ${l.id}`},[o("td",ro,k(l.title),1),o("td",null,k(l.percent)+"%",1),o("td",_o,k(_.$filters.date(l.due_date)),1),o("td",null,[l.is_enabled===1?(b(),v("span",mo,"啟用")):(b(),v("span",bo,"未起用"))]),o("td",null,[o("div",vo,[o("button",{class:"btn btn-outline-primary btn-sm",type:"button",onClick:x=>e.openCouponModal(!1,l)}," 編輯 ",8,fo),o("button",{class:"btn btn-outline-danger btn-sm",type:"button",onClick:x=>e.openDelCouponModal(l)}," 刪除 ",8,ho)])])]))),128))])])]),V(h,{coupon:e.tempCoupon,ref:"couponModal",onUpdateCoupon:e.updateCoupon},null,8,["coupon","onUpdateCoupon"]),V(c,{item:e.tempCoupon,ref:"delModal",onDelItem:e.delCoupon},null,8,["item","onDelItem"])])}const xo=D(ao,[["render",Co]]);export{xo as default};
