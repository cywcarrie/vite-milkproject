import{V as E}from"./VueLoading-BfULdMT8.js";import{_ as T,g as m,A as P,o as v,c as h,a as o,j as M,v as y,I,i as L,n as S,r as k,b as w,e as U,F as j,q as N,S as r,t as D}from"./index-CLkijdjE.js";import{u as O}from"./modal-DNgC60g7.js";import{D as B}from"./DelModal-BKZXDwvI.js";const R={name:"couponModal",props:{coupon:{type:Object,default:()=>({})}},emits:["update-coupon"],setup(i,{emit:n}){const{modalElement:c,showModal:e,hideModal:p}=O(),l=m({}),t=m("");P(()=>i.coupon,b=>{l.value={...b};const s=new Date(l.value.due_date*1e3);t.value=s.toISOString().split("T")[0]}),P(t,b=>{l.value.due_date=Math.floor(new Date(b)/1e3)});function C(){n("update-coupon",l.value),p()}return{tempCoupon:l,due_date:t,modalElement:c,pushCoupon:C,showModal:e,hideModal:p}}},F={class:"modal fade",id:"couponModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modalElement"},H={class:"modal-dialog",role:"document"},q={class:"modal-content"},z=o("div",{class:"modal-header"},[o("h5",{class:"modal-title",id:"exampleModalLabel"},"優惠券"),o("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),G={class:"modal-body"},J={class:"mb-3"},K=o("label",{for:"title"},"標題",-1),Q={class:"mb-3"},W=o("label",{for:"coupon_code"},"優惠碼",-1),X={class:"mb-3"},Y=o("label",{for:"due_date"},"到期日",-1),Z={class:"mb-3"},oo=o("label",{for:"price"},"折扣百分比",-1),eo={class:"mb-3"},to={class:"form-check"},no=o("label",{class:"form-check-label",for:"is_enabled"}," 是否啟用 ",-1),so={class:"modal-footer"},ao=o("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"關閉",-1);function lo(i,n,c,e,p,l){return v(),h("div",F,[o("div",H,[o("div",q,[z,o("div",G,[o("div",J,[K,M(o("input",{type:"text",class:"form-control",id:"title","onUpdate:modelValue":n[0]||(n[0]=t=>e.tempCoupon.title=t),placeholder:"請輸入標題"},null,512),[[y,e.tempCoupon.title]])]),o("div",Q,[W,M(o("input",{type:"text",class:"form-control",id:"coupon_code","onUpdate:modelValue":n[1]||(n[1]=t=>e.tempCoupon.code=t),placeholder:"請輸入優惠碼"},null,512),[[y,e.tempCoupon.code]])]),o("div",X,[Y,M(o("input",{type:"date",class:"form-control",id:"due_date","onUpdate:modelValue":n[2]||(n[2]=t=>e.due_date=t)},null,512),[[y,e.due_date]])]),o("div",Z,[oo,M(o("input",{type:"number",class:"form-control",id:"price","onUpdate:modelValue":n[3]||(n[3]=t=>e.tempCoupon.percent=t),placeholder:"請輸入折扣百分比"},null,512),[[y,e.tempCoupon.percent,void 0,{number:!0}]])]),o("div",eo,[o("div",to,[M(o("input",{class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":n[4]||(n[4]=t=>e.tempCoupon.is_enabled=t),id:"is_enabled"},null,512),[[I,e.tempCoupon.is_enabled]]),no])])]),o("div",so,[ao,o("button",{type:"button",class:"btn btn-primary",onClick:n[5]||(n[5]=(...t)=>e.pushCoupon&&e.pushCoupon(...t))},"確認")])])])],512)}const co=T(R,[["render",lo]]);var uo={VITE_APP_API:"https://vue3-course-api.hexschool.io/",VITE_APP_PATH:"funniecafeweb",BASE_URL:"/vite-milkproject/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_API:g,VITE_APP_PATH:x}=uo,io={components:{VueLoading:E,CouponModal:co,DelModal:B},props:{config:Object},setup(){const i=L("$axios"),n=m({}),c=m({title:"",is_enabled:0,percent:100,code:""}),e=m(!1),p=m(!1),l=m(null),t=m(null);function C(d,a){p.value=d,p.value?c.value.due_date=new Date().getTime()/1e3:c.value={...a},l.value.showModal()}function b(d){c.value={...d},t.value.showModal()}function s(){const d=`${g}api/${x}/admin/coupons`;e.value=!0,i.get(d,c.value).then(a=>{n.value=a.data.coupons}).catch(a=>{var f,_;const u=((_=(f=a.response)==null?void 0:f.data)==null?void 0:_.message)||"發生錯誤，請稍後再試";r("error",u)}).finally(()=>{e.value=!1})}function V(d){if(p.value){const a=`${g}api/${x}/admin/coupon`;e.value=!0,i.post(a,{data:d}).then(u=>{e.value=!1,u.data.success?(r("success","新增優惠劵成功"),s(),l.value.hideModal()):r("error","新增優惠劵失敗")})}else{const a=`${g}api/${x}/admin/coupon/${d.id}`;e.value=!0,i.put(a,{data:d}).then(u=>{u.data.success?(r("success","更新優惠劵成功"),s(),l.value.hideModal()):r("error","更新優惠劵失敗")}).catch(u=>{var _,$;const f=(($=(_=u.response)==null?void 0:_.data)==null?void 0:$.message)||"發生錯誤，請稍後再試";r("error",f)}).finally(()=>{e.value=!1})}}function A(){const d=`${g}api/${x}/admin/coupon/${c.value.id}`;e.value=!0,i.delete(d).then(a=>{a.data.success?(r("success","刪除優惠劵成功"),t.value.hideModal(),s()):r("error","刪除優惠劵失敗")}).catch(a=>{var f,_;const u=((_=(f=a.response)==null?void 0:f.data)==null?void 0:_.message)||"發生錯誤，請稍後再試";r("error",u)}).finally(()=>{e.value=!1})}return S(()=>{s()}),{coupons:n,tempCoupon:c,isLoading:e,isNew:p,couponModal:l,delModal:t,openCouponModal:C,openDelCouponModal:b,getCoupons:s,updateCoupon:V,delCoupon:A}}},po={class:"text-end mt-4"},ro=o("i",{class:"bi bi-plus-lg pe-1"},null,-1),_o={class:"table-responsive"},mo={class:"table mt-4"},bo=o("thead",null,[o("tr",{class:"table-nowrap"},[o("th",null,"名稱"),o("th",{class:"text-nowrap"},"折扣百分比"),o("th",null,"到期日"),o("th",{class:"text-nowrap"},"是否啟用"),o("th",null,"編輯")])],-1),fo={class:"text-nowrap"},vo={class:"text-nowrap"},ho={key:0,class:"text-success"},Co={key:1,class:"text-muted"},Mo={class:"btn-group"},yo=["onClick"],go=["onClick"];function xo(i,n,c,e,p,l){const t=k("VueLoading"),C=k("CouponModal"),b=k("DelModal");return v(),h("div",null,[w(t,{active:e.isLoading},null,8,["active"]),o("div",po,[o("button",{class:"btn btn-primary",type:"button",onClick:n[0]||(n[0]=s=>e.openCouponModal(!0))},[ro,U("新增優惠券 ")])]),o("div",_o,[o("table",mo,[bo,o("tbody",null,[(v(!0),h(j,null,N(e.coupons,s=>(v(),h("tr",{key:`coupon ${s.id}`},[o("td",fo,D(s.title),1),o("td",null,D(s.percent)+"%",1),o("td",vo,D(i.$format.date(s.due_date)),1),o("td",null,[s.is_enabled===1?(v(),h("span",ho,"啟用")):(v(),h("span",Co,"未起用"))]),o("td",null,[o("div",Mo,[o("button",{class:"btn btn-outline-primary btn-sm",type:"button",onClick:V=>e.openCouponModal(!1,s)}," 編輯 ",8,yo),o("button",{class:"btn btn-outline-danger btn-sm",type:"button",onClick:V=>e.openDelCouponModal(s)}," 刪除 ",8,go)])])]))),128))])])]),w(C,{coupon:e.tempCoupon,ref:"couponModal",onUpdateCoupon:e.updateCoupon},null,8,["coupon","onUpdateCoupon"]),w(b,{item:e.tempCoupon,ref:"delModal",onDelItem:e.delCoupon},null,8,["item","onDelItem"])])}const $o=T(io,[["render",xo]]);export{$o as default};
