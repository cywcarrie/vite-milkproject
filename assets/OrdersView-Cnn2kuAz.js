import{_ as A,g as i,A as T,o as n,c as l,a as e,t as s,x as E,F as w,q as D,i as N,n as U,r as x,b as $,S as v,p as j,j as B,I as q}from"./index-qonDLBNP.js";import{V as R}from"./VueLoading-Xsc90l01.js";import{D as F}from"./DelModal-CuxPbw-a.js";import{u as H}from"./modal-Dz_nr82-.js";import{P as z}from"./PaginationComponent-DxKJm8lH.js";const G={name:"orderModal",props:{order:{type:Object,default(){return{}}}},emits:["update-product","update-order"],setup(c,{emit:y}){const{modalElement:M,showModal:t,hideModal:d}=H(),g=i(""),a=i({}),p=i({}),O=i(!1);T(()=>c.order,o=>{p.value=o,O.value=p.value.is_paid});function f(){y("update-order",p.value)}return{modal:g,status:a,tempOrder:p,isPaid:O,showModal:t,hideModal:d,modalElement:M,pushOrderModal:f}}},J={class:"modal fade",id:"productModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modalElement"},K={class:"modal-dialog modal-xl",role:"document"},Q={class:"modal-content border-0"},W=e("div",{class:"modal-header bg-primary text-white"},[e("h5",{class:"modal-title",id:"exampleModalLabel"},[e("span",null,"訂單")]),e("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close"})],-1),X={class:"modal-body"},Y={class:"row"},Z={class:"col-md-4"},ee=e("h3",null,"用戶資料",-1),te={class:"table"},oe={key:0},se=e("th",{class:"order-modal-table"},"姓名",-1),ae=e("th",null,"Email",-1),ne=e("th",null,"電話",-1),le=e("th",null,"地址",-1),de={class:"col-md-8"},re=e("h3",null,"訂單細節",-1),ce={class:"table"},ie=e("th",{class:"order-modal-table"},"訂單編號",-1),ue=e("th",null,"下單時間",-1),_e=e("th",null,"付款時間",-1),pe={key:0},he={key:1},me=e("th",null,"付款狀態",-1),fe={key:0,class:"text-success"},be={key:1,class:"text-muted"},ve=e("th",null,"總金額",-1),ye=e("h3",null,"選購商品",-1),ge={class:"table"},Oe=e("thead",null,[e("tr")],-1),Me={class:"text-end"},ke={class:"modal-footer"},we=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function xe(c,y,M,t,d,g){return n(),l("div",J,[e("div",K,[e("div",Q,[W,e("div",X,[e("div",Y,[e("div",Z,[ee,e("table",te,[t.tempOrder.user?(n(),l("tbody",oe,[e("tr",null,[se,e("td",null,s(t.tempOrder.user.name),1)]),e("tr",null,[ae,e("td",null,s(t.tempOrder.user.email),1)]),e("tr",null,[ne,e("td",null,s(t.tempOrder.user.tel),1)]),e("tr",null,[le,e("td",null,s(t.tempOrder.user.address),1)])])):E("",!0)])]),e("div",de,[re,e("table",ce,[e("tbody",null,[e("tr",null,[ie,e("td",null,s(t.tempOrder.id),1)]),e("tr",null,[ue,e("td",null,s(c.$format.date(t.tempOrder.create_at)),1)]),e("tr",null,[_e,e("td",null,[t.tempOrder.paid_date?(n(),l("span",pe,s(c.$format.date(t.tempOrder.paid_date)),1)):(n(),l("span",he,"時間不正確"))])]),e("tr",null,[me,e("td",null,[t.tempOrder.is_paid?(n(),l("strong",fe,"已付款")):(n(),l("span",be,"尚未付款"))])]),e("tr",null,[ve,e("td",null,s(c.$format.currency(t.tempOrder.total)),1)])])]),ye,e("table",ge,[Oe,e("tbody",null,[(n(!0),l(w,null,D(t.tempOrder.products,a=>(n(),l("tr",{key:a.id},[e("th",null,s(a.product.title),1),e("td",null,s(a.qty)+" / "+s(a.product.unit),1),e("td",Me,s(c.$format.currency(a.final_total)),1)]))),128))])])])])]),e("div",ke,[we,e("button",{type:"button",class:"btn btn-primary",onClick:y[0]||(y[0]=(...a)=>t.pushOrderModal&&t.pushOrderModal(...a))},"確認")])])])],512)}const $e=A(G,[["render",xe]]);var Ce={VITE_APP_API:"https://vue3-course-api.hexschool.io/",VITE_APP_PATH:"funniecafeweb",BASE_URL:"/vite-milkproject/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_API:C,VITE_APP_PATH:P}=Ce,Pe={components:{VueLoading:R,Pagination:z,DelModal:F,OrderModal:$e},setup(){const c=N("$axios"),y=i([]),M=i(!1),t=i({}),d=i(!1),g=i({}),a=i(1),p=i(null),O=i(null);function f(r=1){a.value=r;const u=`${C}api/${P}/admin/orders?page=${r}`;d.value=!0,c.get(u).then(_=>{y.value=_.data.orders,t.value=_.data.pagination}).catch(_=>{var b,k;const m=((k=(b=_.response)==null?void 0:b.data)==null?void 0:k.message)||"發生錯誤，請稍後再試";v("error",m)}).finally(()=>{d.value=!1})}function o(r){g.value={...r},p.value.showModal()}function h(r){g.value={...r},O.value.showModal()}function V(r){const u=`${C}api/${P}/admin/order/${r.id}`,_={is_paid:r.is_paid};d.value=!0,c.put(u,{data:_}).then(m=>{m.data.success?(f(a.value),v("success","更新付款狀態成功")):v("error","更新付款狀態失敗")}).catch(m=>{var k,I;const b=((I=(k=m.response)==null?void 0:k.data)==null?void 0:I.message)||"發生錯誤，請稍後再試";v("error",b)}).finally(()=>{d.value=!1})}function L(r){const u=`${C}api/${P}/admin/order/${r.id}`,_={is_paid:r.is_paid};d.value=!0;const m=p.value;c.put(u,{data:_}).then(b=>{d.value=!1,m.hideModal(),b.data.success?(f(a.value),v("success","確認成功")):(d.value=!1,v("error","確認失敗"))})}function S(){const r=`${C}api/${P}/admin/order/${g.value.id}`;d.value=!0,c.delete(r).then(u=>{O.value.hideModal(),u.data.success?(v("success","刪除成功"),f(a.value)):v("error","刪除失敗")}).catch(u=>{var m,b;const _=((b=(m=u.response)==null?void 0:m.data)==null?void 0:b.message)||"發生錯誤，請稍後再試";v("error",_)}).finally(()=>{d.value=!1})}return U(()=>{f()}),{orders:y,isNew:M,pagination:t,isLoading:d,tempOrder:g,currentPage:a,getOrders:f,openModal:o,openDelOrderModal:h,updatePaid:V,delOrder:S,orderModal:p,delModal:O,checkOrderInfo:L}}},Ve={class:"table-responsive"},Ee={class:"table mt-4"},De=e("thead",null,[e("tr",{class:"table-nowrap"},[e("th",{class:"text-nowrap"},"購買時間"),e("th",null,"Email"),e("th",{class:"text-nowrap"},"購買款項"),e("th",{class:"text-nowrap"},"應付金額"),e("th",{class:"text-nowrap"},"是否付款"),e("th",null,"編輯")])],-1),Ie=["textContent"],Ae={class:"list-unstyled text-nowrap"},Le={class:"text-nowrap"},Se={class:"form-check form-switch"},Te=["id","onUpdate:modelValue","onChange"],Ne=["for"],Ue={key:0},je={key:1},Be={class:"btn-group"},qe=["onClick"],Re=["onClick"];function Fe(c,y,M,t,d,g){const a=x("VueLoading"),p=x("OrderModal"),O=x("DelModal"),f=x("Pagination");return n(),l(w,null,[$(a,{active:t.isLoading},null,8,["active"]),e("div",Ve,[e("table",Ee,[De,e("tbody",null,[(n(!0),l(w,null,D(t.orders,o=>(n(),l(w,{key:`orders ${o.id}`},[t.orders.length?(n(),l("tr",{key:0,class:j({"text-secondary":!o.is_paid})},[e("td",null,s(c.$format.date(o.create_at)),1),e("td",null,[o.user?(n(),l("span",{key:0,textContent:s(o.user.email)},null,8,Ie)):E("",!0)]),e("td",null,[e("ul",Ae,[(n(!0),l(w,null,D(o.products,(h,V)=>(n(),l("li",{key:V},s(h.product.title)+" 數量："+s(h.qty)+" "+s(h.product.unit),1))),128))])]),e("td",Le,s(o.total),1),e("td",null,[e("div",Se,[B(e("input",{class:"form-check-input",type:"checkbox",id:`paidSwitch${o.id}`,"onUpdate:modelValue":h=>o.is_paid=h,onChange:h=>t.updatePaid(o)},null,40,Te),[[q,o.is_paid]]),e("label",{class:"form-check-label text-nowrap",for:`paidSwitch${o.id}`},[o.is_paid?(n(),l("span",Ue,"已付款")):(n(),l("span",je,"未付款"))],8,Ne)])]),e("td",null,[e("div",Be,[e("button",{class:"btn btn-outline-primary btn-sm",type:"button",onClick:h=>t.openModal(o)}," 檢視 ",8,qe),e("button",{class:"btn btn-outline-danger btn-sm",type:"button",onClick:h=>t.openDelOrderModal(o)}," 刪除 ",8,Re)])])],2)):E("",!0)],64))),128))])])]),$(p,{order:t.tempOrder,ref:"orderModal",onUpdateOrder:t.checkOrderInfo},null,8,["order","onUpdateOrder"]),$(O,{item:t.tempOrder,ref:"delModal",onDelItem:t.delOrder},null,8,["item","onDelItem"]),$(f,{pages:t.pagination,onEmitPages:t.getOrders},null,8,["pages","onEmitPages"])],64)}const Qe=A(Pe,[["render",Fe]]);export{Qe as default};
