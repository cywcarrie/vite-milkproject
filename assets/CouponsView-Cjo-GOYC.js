import{V as P}from"./VueLoading-gheappAG.js";import{_ as w,l as r,B as k,o as b,c as v,a as o,g as f,v as C,J as T,i as A,n as E,r as g,b as $,e as I,F as L,q as S,S as i,t as V}from"./index-tVzfk2aA.js";import{u as U,D as B}from"./DelModal-BvKCWeeT.js";const N={name:"couponModal",props:{coupon:{}},emits:["update-coupon"],setup(u,{emit:n}){const{modalElement:c,showModal:e,hideModal:p}=U(),l=r({}),t=r("");return k(()=>u.coupon,_=>{l.value=_;const s=new Date(l.value.due_date*1e3).toISOString().split("T");[t.value]=s}),k(t,_=>{l.value.due_date=Math.floor(new Date(_)/1e3)}),{tempCoupon:l,due_date:t,modalElement:c,pushCoupon:()=>{n("update-coupon",l.value)},showModal:e,hideModal:p}}},O={class:"modal fade",id:"couponModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modalElement"},j={class:"modal-dialog",role:"document"},R={class:"modal-content"},F=o("div",{class:"modal-header"},[o("h5",{class:"modal-title",id:"exampleModalLabel"},"優惠券"),o("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),H={class:"modal-body"},q={class:"mb-3"},J=o("label",{for:"title"},"標題",-1),z={class:"mb-3"},G=o("label",{for:"coupon_code"},"優惠碼",-1),K={class:"mb-3"},Q=o("label",{for:"due_date"},"到期日",-1),W={class:"mb-3"},X=o("label",{for:"price"},"折扣百分比",-1),Y={class:"mb-3"},Z={class:"form-check"},oo=o("label",{class:"form-check-label",for:"is_enabled"}," 是否啟用 ",-1),eo={class:"modal-footer"},to=o("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"關閉",-1);function no(u,n,c,e,p,l){return b(),v("div",O,[o("div",j,[o("div",R,[F,o("div",H,[o("div",q,[J,f(o("input",{type:"text",class:"form-control",id:"title","onUpdate:modelValue":n[0]||(n[0]=t=>e.tempCoupon.title=t),placeholder:"請輸入標題"},null,512),[[C,e.tempCoupon.title]])]),o("div",z,[G,f(o("input",{type:"text",class:"form-control",id:"coupon_code","onUpdate:modelValue":n[1]||(n[1]=t=>e.tempCoupon.code=t),placeholder:"請輸入優惠碼"},null,512),[[C,e.tempCoupon.code]])]),o("div",K,[Q,f(o("input",{type:"date",class:"form-control",id:"due_date","onUpdate:modelValue":n[2]||(n[2]=t=>e.due_date=t)},null,512),[[C,e.due_date]])]),o("div",W,[X,f(o("input",{type:"number",class:"form-control",id:"price","onUpdate:modelValue":n[3]||(n[3]=t=>e.tempCoupon.percent=t),placeholder:"請輸入折扣百分比"},null,512),[[C,e.tempCoupon.percent,void 0,{number:!0}]])]),o("div",Y,[o("div",Z,[f(o("input",{class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":n[4]||(n[4]=t=>e.tempCoupon.is_enabled=t),id:"is_enabled"},null,512),[[T,e.tempCoupon.is_enabled]]),oo])])]),o("div",eo,[to,o("button",{type:"button",class:"btn btn-primary",onClick:n[5]||(n[5]=(...t)=>e.pushCoupon&&e.pushCoupon(...t))},"確認")])])])],512)}const so=w(N,[["render",no]]);var ao={VITE_APP_API:"https://vue3-course-api.hexschool.io/",VITE_APP_PATH:"funniecafeweb",BASE_URL:"/vite-milkproject/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_API:M,VITE_APP_PATH:x}=ao,lo={components:{VueLoading:P,CouponModal:so,DelModal:B},props:{config:Object},setup(){const u=A("$axios"),n=r({}),c=r({title:"",is_enabled:0,percent:100,code:""}),e=r(!1),p=r(!1),l=r(null),t=r(null);function h(d,a){p.value=d,p.value?c.value.due_date=new Date().getTime()/1e3:c.value={...a},l.value.showModal()}function _(d){c.value={...d},t.value.showModal()}function s(){const d=`${M}api/${x}/admin/coupons`;e.value=!0,u.get(d,c.value).then(a=>{e.value=!1,n.value=a.data.coupons}).catch(a=>{e.value=!1,i("error",`${a.response.data.message}`)})}function y(d){if(p.value){const a=`${M}api/${x}/admin/coupon`;e.value=!0,u.post(a,{data:d}).then(m=>{e.value=!1,m.data.success?(i("success","新增優惠劵成功"),s(),l.value.hideModal()):i("error","新增優惠劵失敗")})}else{const a=`${M}api/${x}/admin/coupon/${d.id}`;e.value=!0,u.put(a,{data:d}).then(m=>{e.value=!1,m.data.success?(i("success","更新優惠劵成功"),s(),l.value.hideModal()):i("error","更新優惠劵失敗")}).catch(m=>{e.value=!1,i("error",`${m.response.data.message}`)})}}function D(){const d=`${M}api/${x}/admin/coupon/${c.value.id}`;e.value=!0,u.delete(d).then(a=>{e.value=!1,a.data.success?(i("success","刪除優惠劵成功"),t.value.hideModal(),s()):i("error","刪除優惠劵失敗")}).catch(a=>{e.value=!1,i("error",`${a.response.data.message}`)})}return E(()=>{s()}),{coupons:n,tempCoupon:c,isLoading:e,isNew:p,couponModal:l,delModal:t,openCouponModal:h,openDelCouponModal:_,getCoupons:s,updateCoupon:y,delCoupon:D}}},co={class:"text-end mt-4"},uo=o("i",{class:"bi bi-plus-lg pe-1"},null,-1),io={class:"table-responsive"},po={class:"table mt-4"},ro=o("thead",null,[o("tr",{class:"table-nowrap"},[o("th",null,"名稱"),o("th",{class:"text-nowrap"},"折扣百分比"),o("th",null,"到期日"),o("th",{class:"text-nowrap"},"是否啟用"),o("th",null,"編輯")])],-1),_o={class:"text-nowrap"},mo={class:"text-nowrap"},bo={key:0,class:"text-success"},vo={key:1,class:"text-muted"},fo={class:"btn-group"},ho=["onClick"],Co=["onClick"];function Mo(u,n,c,e,p,l){const t=g("VueLoading"),h=g("couponModal"),_=g("DelModal");return b(),v("div",null,[$(t,{active:e.isLoading},null,8,["active"]),o("div",co,[o("button",{class:"btn btn-primary",type:"button",onClick:n[0]||(n[0]=s=>e.openCouponModal(!0))},[uo,I("新增優惠券 ")])]),o("div",io,[o("table",po,[ro,o("tbody",null,[(b(!0),v(L,null,S(e.coupons,s=>(b(),v("tr",{key:`coupon ${s.id}`},[o("td",_o,V(s.title),1),o("td",null,V(s.percent)+"%",1),o("td",mo,V(u.$filters.date(s.due_date)),1),o("td",null,[s.is_enabled===1?(b(),v("span",bo,"啟用")):(b(),v("span",vo,"未起用"))]),o("td",null,[o("div",fo,[o("button",{class:"btn btn-outline-primary btn-sm",type:"button",onClick:y=>e.openCouponModal(!1,s)}," 編輯 ",8,ho),o("button",{class:"btn btn-outline-danger btn-sm",type:"button",onClick:y=>e.openDelCouponModal(s)}," 刪除 ",8,Co)])])]))),128))])])]),$(h,{coupon:e.tempCoupon,ref:"couponModal",onUpdateCoupon:e.updateCoupon},null,8,["coupon","onUpdateCoupon"]),$(_,{item:e.tempCoupon,ref:"delModal",onDelItem:e.delCoupon},null,8,["item","onDelItem"])])}const $o=w(lo,[["render",Mo]]);export{$o as default};
