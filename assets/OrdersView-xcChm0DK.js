import{_ as E,l as i,B as L,o as n,c as d,a as e,t as s,x as P,F as M,q as V,i as S,n as T,r as k,b as $,S as f,p as B,g as N,J as U}from"./index-tVzfk2aA.js";import{V as j}from"./VueLoading-gheappAG.js";import{u as q,D as R}from"./DelModal-BvKCWeeT.js";import{P as F}from"./PaginationComponent-Cx2lctFN.js";const H={name:"orderModal",props:{order:{type:Object,default(){return{}}}},emits:["update-product","update-order"],setup(c,{emit:b}){const{modalElement:y,showModal:t,hideModal:a}=q(),h=i(""),l=i({}),_=i({}),v=i(!1);return L(()=>c.order,o=>{_.value=o,v.value=_.value.is_paid}),{modal:h,status:l,tempOrder:_,isPaid:v,showModal:t,hideModal:a,modalElement:y,pushOrderModal:()=>{b("update-order",_.value)}}}},z={class:"modal fade",id:"productModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modalElement"},J={class:"modal-dialog modal-xl",role:"document"},G={class:"modal-content border-0"},K=e("div",{class:"modal-header bg-primary text-white"},[e("h5",{class:"modal-title",id:"exampleModalLabel"},[e("span",null,"訂單內容")]),e("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close"})],-1),Q={class:"modal-body"},W={class:"row"},X={class:"col-md-4"},Y=e("h3",null,"用戶資料",-1),Z={class:"table"},ee={key:0},te=e("th",{class:"order-modal-table"},"姓名",-1),oe=e("th",null,"Email",-1),se=e("th",null,"電話",-1),ae=e("th",null,"地址",-1),le={class:"col-md-8"},ne=e("h3",null,"訂單細節",-1),de={class:"table"},re=e("th",{class:"order-modal-table"},"訂單編號",-1),ce=e("th",null,"下單時間",-1),ie=e("th",null,"付款時間",-1),ue={key:0},_e={key:1},pe=e("th",null,"付款狀態",-1),he={key:0,class:"text-success"},me={key:1,class:"text-muted"},fe=e("th",null,"總金額",-1),be=e("h3",null,"選購商品",-1),ve={class:"table"},Oe=e("thead",null,[e("tr")],-1),ye={class:"text-end"},ge={class:"modal-footer"},Me=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function ke(c,b,y,t,a,h){return n(),d("div",z,[e("div",J,[e("div",G,[K,e("div",Q,[e("div",W,[e("div",X,[Y,e("table",Z,[t.tempOrder.user?(n(),d("tbody",ee,[e("tr",null,[te,e("td",null,s(t.tempOrder.user.name),1)]),e("tr",null,[oe,e("td",null,s(t.tempOrder.user.email),1)]),e("tr",null,[se,e("td",null,s(t.tempOrder.user.tel),1)]),e("tr",null,[ae,e("td",null,s(t.tempOrder.user.address),1)])])):P("",!0)])]),e("div",le,[ne,e("table",de,[e("tbody",null,[e("tr",null,[re,e("td",null,s(t.tempOrder.id),1)]),e("tr",null,[ce,e("td",null,s(c.$filters.date(t.tempOrder.create_at)),1)]),e("tr",null,[ie,e("td",null,[t.tempOrder.paid_date?(n(),d("span",ue,s(c.$filters.date(t.tempOrder.paid_date)),1)):(n(),d("span",_e,"時間不正確"))])]),e("tr",null,[pe,e("td",null,[t.tempOrder.is_paid?(n(),d("strong",he,"已付款")):(n(),d("span",me,"尚未付款"))])]),e("tr",null,[fe,e("td",null,s(c.$filters.currency(t.tempOrder.total)),1)])])]),be,e("table",ve,[Oe,e("tbody",null,[(n(!0),d(M,null,V(t.tempOrder.products,l=>(n(),d("tr",{key:l.id},[e("th",null,s(l.product.title),1),e("td",null,s(l.qty)+" / "+s(l.product.unit),1),e("td",ye,s(c.$filters.currency(l.final_total)),1)]))),128))])])])])]),e("div",ge,[Me,e("button",{type:"button",class:"btn btn-primary",onClick:b[0]||(b[0]=(...l)=>t.pushOrderModal&&t.pushOrderModal(...l))},"確認")])])])],512)}const $e=E(H,[["render",ke]]);var xe={VITE_APP_API:"https://vue3-course-api.hexschool.io/",VITE_APP_PATH:"funniecafeweb",BASE_URL:"/vite-milkproject/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_API:x,VITE_APP_PATH:w}=xe,we={components:{VueLoading:j,Pagination:F,DelModal:R,OrderModal:$e},setup(){const c=S("$axios"),b=i({}),y=i(!1),t=i({}),a=i(!1),h=i({}),l=i(1),_=i(null),v=i(null);function O(r=1){l.value=r;const u=`${x}api/${w}/admin/orders?page=${r}`;a.value=!0,c.get(u,h).then(m=>{a.value=!1,b.value=m.data.orders,t.value=m.data.pagination}).catch(m=>{a.value=!1,f("error",`${m.response.data.message}`)})}function o(r){h.value={...r},_.value.showModal()}function p(r){h.value={...r},v.value.showModal()}function C(r){const u=`${x}api/${w}/admin/order/${r.id}`,m={is_paid:r.is_paid};a.value=!0,c.put(u,{data:m}).then(g=>{a.value=!1,g.data.success?(O(l.value),f("success","更新付款狀態成功")):f("error","更新付款狀態失敗")}).catch(g=>{a.value=!1,f("error",`${g.response.data.message}`)})}function D(r){const u=`${x}api/${w}/admin/order/${r.id}`,m={is_paid:r.is_paid};a.value=!0;const g=_.value;c.put(u,{data:m}).then(A=>{a.value=!1,g.hideModal(),A.data.success?(O(l.value),f("success","確認成功")):(a.value=!1,f("error","確認失敗"))})}function I(){const r=`${x}api/${w}/admin/order/${h.value.id}`;a.value=!0,c.delete(r).then(u=>{a.value=!1,v.value.hideModal(),u.data.success?(f("success","刪除成功"),O(l.value)):f("error","刪除失敗")}).catch(u=>{a.value=!1,f("error",`${u.response.data.message}`)})}return T(()=>{O()}),{orders:b,isNew:y,pagination:t,isLoading:a,tempOrder:h,currentPage:l,getOrders:O,openModal:o,openDelOrderModal:p,updatePaid:C,delOrder:I,orderModal:_,delModal:v,checkOrderInfo:D}}},Ce={class:"table-responsive"},Pe={class:"table mt-4"},Ve=e("thead",null,[e("tr",{class:"table-nowrap"},[e("th",{class:"text-nowrap"},"購買時間"),e("th",null,"Email"),e("th",{class:"text-nowrap"},"購買款項"),e("th",{class:"text-nowrap"},"應付金額"),e("th",{class:"text-nowrap"},"是否付款"),e("th",null,"編輯")])],-1),Ee=["textContent"],De={class:"list-unstyled text-nowrap"},Ie={class:"text-right"},Ae={class:"form-check form-switch"},Le=["id","onUpdate:modelValue","onChange"],Se=["for"],Te={key:0},Be={key:1},Ne={class:"btn-group"},Ue=["onClick"],je=["onClick"];function qe(c,b,y,t,a,h){const l=k("VueLoading"),_=k("OrderModal"),v=k("DelModal"),O=k("Pagination");return n(),d(M,null,[$(l,{active:t.isLoading},null,8,["active"]),e("div",Ce,[e("table",Pe,[Ve,e("tbody",null,[(n(!0),d(M,null,V(t.orders,o=>(n(),d(M,{key:`orders ${o.id}`},[t.orders.length?(n(),d("tr",{key:0,class:B({"text-secondary":!o.is_paid})},[e("td",null,s(c.$filters.date(o.create_at)),1),e("td",null,[o.user?(n(),d("span",{key:0,textContent:s(o.user.email)},null,8,Ee)):P("",!0)]),e("td",null,[e("ul",De,[(n(!0),d(M,null,V(o.products,(p,C)=>(n(),d("li",{key:C},s(p.product.title)+" 數量："+s(p.qty)+" "+s(p.product.unit),1))),128))])]),e("td",Ie,s(o.total),1),e("td",null,[e("div",Ae,[N(e("input",{class:"form-check-input",type:"checkbox",id:`paidSwitch${o.id}`,"onUpdate:modelValue":p=>o.is_paid=p,onChange:p=>t.updatePaid(o)},null,40,Le),[[U,o.is_paid]]),e("label",{class:"form-check-label text-nowrap",for:`paidSwitch${o.id}`},[o.is_paid?(n(),d("span",Te,"已付款")):(n(),d("span",Be,"未付款"))],8,Se)])]),e("td",null,[e("div",Ne,[e("button",{class:"btn btn-outline-primary btn-sm",type:"button",onClick:p=>t.openModal(o)}," 檢視 ",8,Ue),e("button",{class:"btn btn-outline-danger btn-sm",type:"button",onClick:p=>t.openDelOrderModal(o)}," 刪除 ",8,je)])])],2)):P("",!0)],64))),128))])])]),$(_,{order:t.tempOrder,ref:"orderModal",onUpdateOrder:t.checkOrderInfo},null,8,["order","onUpdateOrder"]),$(v,{item:t.tempOrder,ref:"delModal",onDelItem:t.delOrder},null,8,["item","onDelItem"]),$(O,{pages:t.pagination,onEmitPages:t.getOrders},null,8,["pages","onEmitPages"])],64)}const Je=E(we,[["render",qe]]);export{Je as default};
